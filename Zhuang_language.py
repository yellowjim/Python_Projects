# -*- coding:utf-8 -*-
import sys
reload(sys)
sys.setdefaultencoding('utf-8')
import urllib2
import urllib
import mysql.connector
import re
import csv
import os
from Tkinter import *

c_path=os.getcwd()+'\\'
db_place = {}
sum_place = 0
p=re.compile('\\r\\n\\t\\t([a-z]+)\\t\\t')
dic_zhuangyu={u'爱':'ai',
u'隘':'ai',
u'安':'an',
u'巴':'ba',
u'坝':'ba',
u'捌':'ba',
u'八':'baz',
u'把':'baj',
u'八':'baq',
u'巴':'baq',
u'百':'baq',
u'把':'baq',
u'巴':'bah',
u'吧':'bah',
u'岜':'bah',
u'八':'bak',
u'巴':'bak',
u'北':'bak',
u'白':'bak',
u'百':'bak',
u'宝':'bak',
u'岜':'bak',
u'坝':'bak',
u'伯':'bak',
u'拔':'bak',
u'福':'bak',
u'瀑':'bak',
u'朋':'baengh',
u'派':'bai',
u'排':'baiz',
u'巴':'baih',
u'派':'baih',
u'拜':'baih',
u'排':'baih',
u'摆':'baih',
u'巴':'ban',
u'班':'banz',
u'排':'banz',
u'牌':'banz',
u'盘':'banz',
u'板':'banj',
u'班':'banh',
u'庞':'bangz',
u'邦':'bangx',
u'把':'bangx',
u'旁':'bangx',
u'傍':'bangx',
u'榜':'bangx',
u'保':'bauj',
u'宝':'bauj',
u'八':'beg',
u'扁':'benj',
u'笔':'biz',
u'白':'biek',
u'白':'bieg',
u'平':'bien',
u'平':'biengh',
u'平':'bingz',
u'扁':'bingz',
u'卜':'bo',
u'不':'bo',
u'毛':'bo',
u'巴':'bo',
u'布':'bo',
u'波':'bo',
u'坡':'bo',
u'保':'bo',
u'捕':'bo',
u'破':'bo',
u'婆':'bo',
u'谋':'bo',
u'福':'bo',
u'播':'bo',
u'坡':'boh',
u'坡':'bouj',
u'甫':'bouj',
u'卜':'boux',
u'甫':'boux',
u'富':'boux',
u'卜':'bu',
u'布':'bu',
u'卜':'buz',
u'布':'buj',
u'普':'buj',
u'潘':'buen',
u'北':'bwz',
u'白':'bwz',
u'百':'bwz',
u'伯':'bwz',
u'八':'bya',
u'巴':'bya',
u'加':'bya',
u'白':'bya',
u'百':'bya',
u'把':'bya',
u'沙':'bya',
u'岜':'bya',
u'宝':'bya',
u'表':'bya',
u'法':'bya',
u'摆':'bya',
u'茶':'caz',
u'砦':'cai',
u'寨':'cai',
u'在':'zaiz',
u'寨':'zaiz',
u'才':'caih',
u'寨':'caih',
u'盏':'canz',
u'香':'cang',
u'长':'cangz',
u'常':'cangz',
u'上':'cangh',
u'匠':'cangh',
u'昌':'cangh',
u'常':'cangh',
u'兆':'cauz',
u'皂':'cauz',
u'朝':'cauz',
u'接':'cez',
u'砦':'cez',
u'者':'cej',
u'石':'ceq',
u'者':'ceq',
u'切':'ceh',
u'社':'ceh',
u'者':'ceh',
u'赐':'ceh',
u'峙':'ceh',
u'接':'ceh',
u'砦':'ceh',
u'城':'cak',
u'峙':'ci',
u'七':'ciz',
u'石':'ciz',
u'是':'ciq',
u'社':'cih',
u'实':'cih',
u'长':'ciengz',
u'祥':'ciengz',
u'上':'ciengx',
u'篆':'cimx',
u'青':'cing',
u'声':'cingq',
u'周':'ciu',
u'作':'coz',
u'逐':'coeg',
u'冲':'coeng',
u'从':'coengz',
u'唱':'coengh',
u'从':'congh',
u'冲':'congh',
u'串':'congh',
u'松':'congh',
u'总':'congh',
u'洞':'congh',
u'重':'congh',
u'憧':'congh',
u'周':'couh',
u'逐':'cuz',
u'逐':'cug',
u'冲':'cuengq',
u'陈':'cumz',
u'重':'cungz',
u'大':'da',
u'打':'da',
u'达':'daz',
u'打':'daj',
u'大':'dah',
u'打':'dah',
u'多':'dah',
u'驮':'dah',
u'达':'dah',
u'霞':'dah',
u'达':'dat',
u'塔':'dat',
u'难':'dat',
u'底':'daej',
u'德':'daek',
u'登':'daem',
u'邓':'daemz',
u'屯':'daemz',
u'田':'daemz',
u'旦':'daemz',
u'坛':'daemz',
u'渠':'daemz',
u'榃':'daemz',
u'塘':'daemz',
u'谭':'daemz',
u'潭':'daemz',
u'吞':'daem',
u'吞':'daenh',
u'堂':'daengz',
u'当':'daengq',
u'邓':'daengx',
u'斗':'daeuj',
u'道':'daeuh',
u'太':'dai',
u'台':'daiz',
u'大':'daih',
u'太':'daih',
u'丹':'dam',
u'兰':'dan',
u'丹':'dan',
u'单':'dan',
u'丹':'danz',
u'坛':'danz',
u'榃':'danz',
u'潭':'danz',
u'当':'dang',
u'汤':'dang',
u'塘':'dang',
u'塘':'dangz',
u'汤':'dangh',
u'德':'deq',
u'及':'deq',
u'大':'deih',
u'太':'deih',
u'地':'deih',
u'驮':'deih',
u'多':'deih',
u'天':'denh',
u'定':'dengz',
u'刁':'deu',
u'地':'di',
u'地':'diz',
u'渠':'diz',
u'地':'dij',
u'地':'dih',
u'土':'dieg',
u'斗':'dieg',
u'立':'dieg',
u'地':'dieg',
u'特':'dieg',
u'天':'dien',
u'庭':'diengz',
u'廷':'diengz',
u'金':'din',
u'定':'din',
u'点':'din',
u'丁':'ding',
u'天':'ding',
u'定':'ding',
u'廷':'dingz',
u'定':'dingz',
u'庭':'dingz',
u'亭':'dingz',
u'停':'dingz',
u'登':'dingz',
u'丁':'dingj',
u'廷':'dingj',
u'定':'dingj',
u'顶':'dingj',
u'亭':'dingj',
u'定':'dingq',
u'亭':'dingq',
u'丁':'dingh',
u'汀':'dingh',
u'廷':'dingh',
u'定':'dingh',
u'顶':'dingh',
u'庭':'dingh',
u'停':'dingh',
u'驮':'doz',
u'多':'doh',
u'笃':'doek',
u'当':'doenq',
u'同':'doengz',
u'东':'doengj',
u'东':'doengh',
u'同':'doengh',
u'冻':'doengh',
u'洞':'doengh',
u'垌':'doengh',
u'峒':'doengh',
u'桐':'doengh',
u'董':'doengh',
u'懂':'doengh',
u'兑':'doih',
u'豆':'dou',
u'都':'dou',
u'都':'duz',
u'土':'duj',
u'都':'duh',
u'潭':'dumz',
u'屯':'dunz',
u'屯':'dunh',
u'敦':'dunh',
u'洞':'dung',
u'垌':'dung',
u'峒':'dung',
u'桐':'dung',
u'栋':'dung',
u'同':'dungz',
u'董':'dungj',
u'懂':'dungj',
u'东':'dungh',
u'岽':'dungh',
u'洞':'dungh',
u'栋':'dungh',
u'德':'dwz',
u'吞':'dwnz',
u'汤':'dwngj',
u'登':'dwngh',
u'发':'faz',
u'花':'faz',
u'法':'fax',
u'发':'fag',
u'伏':'fag',
u'法':'fag',
u'福':'fag',
u'米':'faex',
u'福':'faex',
u'伏':'feag',
u'歪':'fai',
u'派':'fai',
u'万':'fan',
u'肥':'feiz',
u'伏':'fuz',
u'扶':'fuz',
u'福':'fuz',
u'逢':'fungz',
u'巴':'fwz',
u'加':'ga',
u'甲':'ga',
u'卡':'ga',
u'建':'ga',
u'高':'ga',
u'个':'gaz',
u'加':'gaz',
u'甲':'gaz',
u'卡':'gaj',
u'甲':'gap',
u'架':'gak',
u'岩':'geam',
u'高':'gean',
u'根':'gaenq',
u'九':'geau',
u'口':'geau',
u'古':'geau',
u'扣':'geau',
u'高':'geau',
u'扣':'gaeuj',
u'皆':'gaih',
u'甘':'gamj',
u'干':'gamj',
u'甘':'gamj',
u'吟':'gamj',
u'敢':'gamj',
u'感':'gamj',
u'堪':'gamj',
u'乾':'gamh',
u'敢':'ganj',
u'感':'ganj',
u'甘':'ganh',
u'康':'gang',
u'康':'gangz',
u'康':'gangh',
u'交':'gau',
u'高':'gauh',
u'可':'gej',
u'吉':'gej',
u'个':'gex',
u'吉':'geh',
u'结':'geh',
u'见':'gemh',
u'廷':'gemh',
u'权':'gemh',
u'兴':'gemh',
u'更':'gemh',
u'岑':'gemh',
u'建':'gemh',
u'俭':'gemh',
u'兼':'gemh',
u'敢':'gemh',
u'乾':'gemh',
u'琴':'gemh',
u'简':'gemh',
u'乾':'genz',
u'更':'geng',
u'庚':'geng',
u'埂':'geng',
u'峺':'geng',
u'简':'geng',
u'叫':'geuq',
u'纪':'gi',
u'局':'giz',
u'其':'giz',
u'菊':'giz',
u'渠':'giz',
u'棋':'giz',
u'计':'gix',
u'基':'giq',
u'检':'gip',
u'京':'gieng',
u'近':'gin',
u'琴':'ginz',
u'群':'ginz',
u'钦':'ginh',
u'敬':'gingq',
u'境':'gingq',
u'乔':'giuz',
u'桥':'giuz',
u'九':'giuj',
u'久':'giuj',
u'个':'go',
u'戈':'go',
u'古':'go',
u'可':'go',
u'各':'go',
u'果':'go',
u'姑':'go',
u'枯':'go',
u'高':'go',
u'歌':'go',
u'可':'goz',
u'各':'goz',
u'国':'goz',
u'阁':'goz',
u'果':'goj',
u'可':'gox',
u'过':'gox',
u'国':'gox',
u'歌':'goq',
u'戈':'goh',
u'局':'gok',
u'谷':'gok',
u'角':'gok',
u'国':'gok',
u'个':'goek',
u'可':'goek',
u'过':'goek',
u'各':'goek',
u'局':'goek',
u'谷':'goek',
u'果':'goek',
u'坤':'goek',
u'故':'goek',
u'格':'goek',
u'菊':'goek',
u'谷':'goek',
u'足':'goek',
u'角':'goek',
u'局':'goek',
u'坤':'goenj',
u'功':'goengq',
u'九':'gouj',
u'古':'guj',
u'枯':'guh',
u'可':'guk',
u'古':'guk',
u'局':'guk',
u'福':'guk',
u'局':'gug',
u'岑':'gumz',
u'坤':'gumz',
u'洪':'gumz',
u'烘':'gumz',
u'涔':'gumz',
u'琴':'gumz',
u'岑':'gumh',
u'哄':'gumh',
u'坤':'gumh',
u'孔':'gungj',
u'公':'gungh',
u'弓':'gvaengz',
u'广':'gvangq',
u'汪':'gvangq',
u'光':'gvang',
u'广':'gvangq',
u'规':'gveih',
u'渠':'gwz',
u'渠':'gwj',
u'加':'gwnz',
u'另':'gwnz',
u'近':'gwnz',
u'克':'gwnz',
u'更':'gwnz',
u'金':'gwnz',
u'肯':'gwnz',
u'埂':'gwnz',
u'根':'gwnz',
u'琴':'gwnz',
u'勤':'gwnz',
u'肯':'gwnj',
u'更':'gwngh',
u'加 ':'gya',
u'甲':'gyaq',
u'查':'gyaq',
u'加':'gyah',
u'甲':'gyah',
u'架':'gyah',
u'加':'gyah',
u'九':'gyaeuj',
u'久':'gyaeuj',
u'丘':'gyaeuj',
u'吉':'gyaeuj',
u'交':'gyaeuj',
u'周':'gyaeuj',
u'苟':'gyaeuj',
u'坵':'gyaeuj',
u'高':'gyaeuj',
u'江':'gyang',
u'壮':'gyang',
u'降':'gyang',
u'江':'gyangh',
u'乔':'gyauz',
u'桥':'gyauz',
u'交':'gyauh',
u'叫':'gyeuq',
u'各':'gyok',
u'却':'gyok',
u'确':'gyok',
u'却':'gyonj',
u'群':'gyonj',
u'下':'haz',
u'禾':'haz',
u'荷':'haz',
u'河':'hah',
u'痕':'haenz',
u'恒':'haengz',
u'谐':'hai',
u'谐':'haiz',
u'海':'haij',
u'康':'hang',
u'杭':'hangz',
u'项':'hangz',
u'康':'hangz',
u'康':'hangh',
u'浩':'hau',
u'圩':'haw',
u'地':'haw',
u'把':'haw',
u'板':'haw',
u'然':'henz',
u'兴':'hingh',
u'合':'hoz',
u'何':'hoz',
u'河':'hoz',
u'俄':'hoz',
u'荷':'hoz',
u'局':'hog',
u'红':'hoengz',
u'哄':'hongh',
u'呼':'hu',
u'魁':'hui',
u'规':'huij',
u'洪':'hungz',
u'汪':'img',
u'润':'laj',
u'加':'laj',
u'乐':'laj',
u'拉':'laj',
u'亚':'laj',
u'淋':'laj',
u'逻':'laj',
u'雅':'laj',
u'拉':'lah',
u'腊':'lak',
u'龙':'laeng',
u'伦':'laeng',
u'冷':'laeng',
u'良':'laeng',
u'浪':'laeng',
u'能':'laeng',
u'塄':'laeng',
u'楞':'laeng',
u'柳':'laeuj',
u'赖':'lai',
u'濑':'lai',
u'蓝':'lamh',
u'兰':'lanz',
u'栏':'lanz',
u'浪':'lang',
u'郎':'langz',
u'灵':'langh',
u'林':'langh',
u'朗':'langh',
u'老':'laux',
u'雷':'leiz',
u'蕾':'leij',
u'里':'leix',
u'良':'lengz',
u'灵':'lengz',
u'伶':'lengz',
u'林':'lengz',
u'料':'leu',
u'利':'li',
u'力':'liz',
u'立':'liz',
u'律':'liz',
u'吕':'lij',
u'淋':'linz',
u'琳':'linz',
u'凌':'lingz',
u'领':'lingj',
u'岭':'lingq',
u'刘':'liuz',
u'乐':'loz',
u'罗':'loz',
u'洛':'loz',
u'逻':'loz',
u'六':'loek',
u'罗':'loek',
u'渌':'loek',
u'绿':'loek',
u'陆':'lueg',
u'弄':'lueg',
u'录':'lueg',
u'罗':'lueg',
u'禄':'lueg',
u'鹿':'lueg',
u'落':'lueg',
u'鲁':'lueg',
u'乱':'luen',
u'空':'lueng',
u'碌':'lueng',
u'王':'luengz',
u'弄':'luengq',
u'佑':'lumj',
u'沦':'lunz',
u'龙':'lung',
u'隆':'lungz',
u'陇':'lungj',
u'马':'ma',
u'妈':'mah',
u'麦':'maeg',
u'蛮':'maz',
u'毛':'mauh',
u'万':'mbanj',
u'古':'mbanj',
u'板':'mbanj',
u'班':'mbanj',
u'麻':'mbanj',
u'曼':'mbanj',
u'晚':'mbanj',
u'满':'mbanj',
u'慢':'mbanj',
u'么':'mboq',
u'木':'mboq',
u'母':'mboq',
u'布':'mboq',
u'务':'mboq',
u'闷':'mboq',
u'咘':'mboq',
u'坡':'mboq',
u'波':'mboq',
u'孟':'mboq',
u'和':'mboq',
u'莫':'mboq',
u'猛':'mboq',
u'幕':'mboq',
u'慕':'mboq',
u'摇':'mboq',
u'逐':'mboep',
u'温':'mbwn',
u'米':'meh',
u'迷':'meh',
u'梅':'meiz',
u'美':'meij',
u'米':'mij',
u'妙':'miuh',
u'磨':'moz',
u'目':'moh',
u'谋':'moux',
u'慕':'mu',
u'那':'naz',
u'纳':'naz',
u'南':'naz',
u'拿':'naz',
u'念':'naz',
u'稔':'naz',
u'南':'namz',
u'囊':'nangz',
u'能':'nangh',
u'吞':'ndaen',
u'糯':'ndaengq',
u'内':'ndaw',
u'龙':'ndaw',
u'列':'ndaw',
u'坤':'ndaw',
u'东':'ndoeng',
u'农':'ndoeng',
u'弄':'ndoeng',
u'岽':'ndoeng',
u'秾':'ndoeng',
u'笃':'ndok',
u'垒':'mdoi',
u'累':'mdoi',
u'堆':'mdoi',
u'雷':'mdoi',
u'蕾':'mdoi',
u'鸾':'nduen',
u'宁':'nengz',
u'安':'ngamz',
u'岸':'ngau',
u'岩':'nguemz',
u'傲':'noj',
u'峨':'ngoz',
u'五':'ngox',
u'诺':'nok',
u'岳':'nyaet',
u'因':'nyaen',
u'远':'nyaen',
u'翁':'oeng',
u'乌':'ouh',
u'欧':'ouh',
u'犁':'raeh',
u'立':'raeb',
u'兰':'raemx',
u'论':'raemx',
u'安':'raemx',
u'冷':'raemx',
u'临':'raemx',
u'南':'raemx',
u'坛':'raengz',
u'玲':'raengz',
u'陵':'raengz',
u'营':'raengz',
u'有':'raeu',
u'来':'raiz',
u'栏':'ranz',
u'练':'renh',
u'渠':'ri',
u'回':'rij',
u'伟':'rij',
u'会':'rij',
u'灰':'rij',
u'尾':'rij',
u'委':'rij',
u'渭':'rij',
u'辉':'rij',
u'康':'rieng',
u'仁':'rin',
u'天':'rin',
u'令':'rin',
u'英':'rin',
u'钦':'rin',
u'磷':'rin',
u'合':'rog',
u'玉':'roeg',
u'雍':'roengj',
u'孔':'rungh',
u'峒':'rungh',
u'懂':'rungh',
u'沙':'sa',
u'西':'sae',
u'思':'sae',
u'色':'saek',
u'才':'saiz',
u'寨':'saih',
u'三':'sam',
u'蚕':'sanq',
u'床':'sangz',
u'上':'sangj',
u'双':'sangh',
u'桑':'sangh',
u'社':'se',
u'自':'seiq',
u'芝':'siz',
u'太':'sij',
u'史':'sij',
u'四':'sij',
u'社':'six',
u'石':'sik',
u'祥':'siengz',
u'苏':'so',
u'索':'soz',
u'作':'sok',
u'苏':'sok',
u'所':'sok',
u'活':'sok',
u'朔':'sok',
u'宿':'sok',
u'溯':'sok',
u'足':'sog',
u'逐':'soeg',
u'宋':'song',
u'熟':'suz',
u'足':'suek',
u'双':'sueng',
u'赐':'sw',
u'翁':'ung',
u'化':'va',
u'花':'va',
u'华':'vaz',
u'旺':'vaengz',
u'汪':'vaengz',
u'黄':'vaengz',
u'怀':'vaiz',
u'歪':'vaiz',
u'槐':'vaiz',
u'万':'van',
u'王':'vangh',
u'为':'viz',
u'才华':'vog',
u'五':'vuj',
u'云':'vunz',
u'温':'vwnh',
u'下':'yah',
u'央':'yang',
u'香':'yang',
u'义':'yi',
u'意':'yi',
u'乙':'yiz',
u'益':'yiz',
u'亿':'yiet',
u'羊':'yiengz',
u'杨':'yiengz',
u'英':'yingh',
u'印':'yin',
u'有':'yiuz',
u'尧':'yiuz',
u'腰':'yiuj',
u'幼':'youq',
u'玉':'yuz',
u'雍':'yum'}

# def db2csv(guid,id,name,word):
#     with open(c_path+u'壮语地名书写.csv', 'w+') as csvfile:
#         fieldnames = [u'GUID', u'FeatureID',u'标准名称',u'壮语书写']
#         writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
#         writer.writeheader()
#         writer.writerow({u'GUID':guid, u'FeatureID':id,u'标准名称':name,u'壮语书写':word})
#         csvfile.close()

def choose_word(word,flag):
    temp_dic={}
    for x in word:
        len_word=len(x)
        temp_dic[len(x)]=x
    temp_dic=sorted(temp_dic.iteritems(), key=lambda d: d[0], reverse=False)
    if flag==1:
        return temp_dic[0][1].capitalize()
    else:
        return temp_dic[0][1]


def query_word(word,flag):
    if dic_zhuangyu.has_key(word) and flag==1:
        return dic_zhuangyu[word].capitalize()
    elif dic_zhuangyu.has_key(word) and flag!=1:
        return dic_zhuangyu[word]
    else:
        js=word.encode('utf-8')
        post_data = {'cih': '', 'js': js, 't1': '提交'}
        while 1:
            try:
                post = urllib2.urlopen(url= 'http://www.jiu60.com/hoiz/sawl.asp',data= urllib.urlencode(post_data))
                break
            except:
                print u'【 '+js+u' 】'+u'字查询异常，正在重新查询！'
                pass
        l_word=p.findall(post.read())
        if l_word==[]:
            return ''
        elif flag==1:
            return choose_word(l_word,1)
        else:
            return choose_word(l_word,0)

def main():
    global sum_place
    try:
        os.remove(c_path+u'壮语地名书写.csv')
    except:
        pass
    ip=raw_input("输入IP地址：")
    dmpc = mysql.connector.connect(user='root', password='GwGcgx@2016!',host=ip, database='dmpc1', use_unicode=True)
    cursor = dmpc.cursor()
    cursor.execute("SELECT f_id,f_idcode,f_name,f_nationalname from tb_place_info where f_region like '450125%' and f_language='壮语'")
    data=cursor.fetchall()
    for f_id,f_idcode,f_name,f_nationalname in data:
        db_place[f_id]=[f_idcode,f_name,f_nationalname]
        sum_place+=1
    for n,guid in enumerate(db_place):
        for i,sub_word in enumerate(db_place[guid][1]):
            if i==0:
                nationalname=[]
                # db2csv(place,db_place[place][0],db_place[place][1],db_place[place][2]+query_word(sub_word,1))
                nationalname.append(query_word(sub_word, 1))
            else:
                # db2csv(place, db_place[place][0], db_place[place][1], db_place[place][2] + query_word(sub_word, 0))
                nationalname.append(query_word(sub_word, 0))
        db_place[guid][2]="".join(nationalname)
        print '当前正在译写第【 '+str(n)+'/'+str(sum_place)+' 】个地名：',db_place[guid][1],db_place[guid][2]
        cursor.execute("UPDATE tb_place_info set f_nationalname=%s where f_id=%s",(db_place[guid][2],guid))
        dmpc.commit()
    cursor.close()
    dmpc.close()

if __name__ == '__main__':
    main()
